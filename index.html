<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iPrincesses - Home</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 1rem; }
    h1,h2,h3 { color: #e91e63; }
    #chat-container, #search-results, #map, #posts-container, #public-profile-posts { 
      border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; max-height:300px; overflow-y:auto; 
    }
    input, button { padding: 0.5rem; margin: 0.3rem 0; }
    .post { border-bottom: 1px solid #eee; padding: 0.5rem; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>iPrincesses ðŸ‘¸</h1>

  <!-- Auth Section -->
  <div id="auth-section">
    <h2>Sign Up</h2>
    <form id="signup-form">
      <input type="email" id="signup-email" placeholder="Enter email" required><br>
      <input type="password" id="signup-password" placeholder="Enter password" required><br>
      <button type="submit">Sign Up</button>
    </form>

    <h2>Login</h2>
    <form id="login-form">
      <input type="email" id="login-email" placeholder="Enter email" required><br>
      <input type="password" id="login-password" placeholder="Enter password" required><br>
      <button type="submit">Login</button>
    </form>

    <button id="logout-btn" style="display:none;">Logout</button>
  </div>

  <!-- Profile Settings -->
  <h2>Profile Settings</h2>
  <div id="profile-settings" class="hidden">
    <form id="profile-form">
      <label>Display Name:</label><br>
      <input type="text" id="profile-name" placeholder="Enter your name"><br>

      <label>Profile Picture:</label><br>
      <input type="file" id="profile-pic"><br>

      <button type="submit">Save Profile</button>
    </form>

    <div id="profile-preview">
      <h3>Preview:</h3>
      <img id="profile-avatar" src="https://via.placeholder.com/100" width="100" style="border-radius:50%;">
      <p id="profile-display-name">Anonymous</p>
    </div>
  </div>

  <!-- Search Section -->
  <h2>Search</h2>
  <input type="text" id="search-input" placeholder="Search posts or users...">
  <div id="search-results"></div>

  <!-- Posts Section -->
  <h2>Posts</h2>
  <div id="posts-container"></div>
  <form id="post-form">
    <input type="text" id="post-content" placeholder="Create a post..." required>
    <button type="submit">Post</button>
  </form>

  <!-- Chat Section -->
  <h2>Chat</h2>
  <div id="chat-container"></div>
  <form id="chat-form">
    <input type="text" id="chat-message" placeholder="Type a message..." required>
    <button type="submit">Send</button>
  </form>

  <!-- Location Sharing -->
  <h2>Share Your Location</h2>
  <button id="share-location-btn">Share My Location</button>
  <div id="map" style="height:300px; width:100%;"></div>

  <!-- Payment Section -->
  <h2>Upgrade / Donate</h2>
  <button id="pay-btn">Pay via Mobile Money (UG)</button>

  <!-- Public Profile Page -->
  <h2>User Profile</h2>
  <div id="public-profile" class="hidden">
    <div id="public-profile-info">
      <img id="public-profile-avatar" src="https://via.placeholder.com/120" width="120" style="border-radius:50%;">
      <h3 id="public-profile-name">Loading...</h3>
      <p id="public-profile-email"></p>
      <p id="public-profile-joined"></p>
      <p id="public-profile-lastlogin"></p>
    </div>

    <h3>Recent Posts</h3>
    <div id="public-profile-posts"></div>

    <button onclick="closeProfile()">Close</button>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <!-- Google Maps -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>

  <!-- Flutterwave -->
  <script src="https://checkout.flutterwave.com/v3.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // AUTH
    document.getElementById("signup-form").addEventListener("submit", e => {
      e.preventDefault();
      const email = document.getElementById("signup-email").value;
      const password = document.getElementById("signup-password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(cred => {
          db.collection("users").doc(cred.user.uid).set({
            email,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          alert("Signup successful!");
        })
        .catch(err => alert(err.message));
    });

    document.getElementById("login-form").addEventListener("submit", e => {
      e.preventDefault();
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => { 
          alert("Login successful!"); 
          document.getElementById("logout-btn").style.display="block"; 
        })
        .catch(err => alert(err.message));
    });

    document.getElementById("logout-btn").addEventListener("click", () => {
      auth.signOut().then(() => { 
        alert("Logged out"); 
        document.getElementById("logout-btn").style.display="none"; 
      });
    });

    // PROFILE SETTINGS
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("profile-settings").classList.remove("hidden");
        db.collection("users").doc(user.uid).get().then(doc => {
          if (doc.exists) {
            const data = doc.data();
            document.getElementById("profile-name").value = data.displayName || "";
            document.getElementById("profile-avatar").src = data.photoURL || "https://via.placeholder.com/100";
            document.getElementById("profile-display-name").textContent = data.displayName || "Anonymous";
          }
        });
      } else {
        document.getElementById("profile-settings").classList.add("hidden");
      }
    });

    document.getElementById("profile-form").addEventListener("submit", async e => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return alert("You must be logged in.");

      const name = document.getElementById("profile-name").value;
      const file = document.getElementById("profile-pic").files[0];
      let photoURL = user.photoURL || "https://via.placeholder.com/100";

      if (file) {
        const storageRef = storage.ref(`profile_pics/${user.uid}`);
        await storageRef.put(file);
        photoURL = await storageRef.getDownloadURL();
      }

      await db.collection("users").doc(user.uid).set({
        displayName: name,
        photoURL,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });

      await user.updateProfile({ displayName: name, photoURL });

      alert("Profile updated!");
      document.getElementById("profile-avatar").src = photoURL;
      document.getElementById("profile-display-name").textContent = name;
    });

    // POSTS
    const postsContainer = document.getElementById("posts-container");
    document.getElementById("post-form").addEventListener("submit", e => {
      e.preventDefault();
      const content = document.getElementById("post-content").value;
      const user = auth.currentUser;
      const userName = user?.displayName || "Anonymous";
      const userId = user?.uid || "anon";
      const userPhoto = user?.photoURL || "https://via.placeholder.com/30";
      db.collection("posts").add({ content, userId, userName, userPhoto, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
      document.getElementById("post-content").value="";
    });

    db.collection("posts").orderBy("timestamp","desc").onSnapshot(snapshot => {
      postsContainer.innerHTML="";
      snapshot.forEach(doc => {
        const post = doc.data();
        const div = document.createElement("div");
        div.className="post";
        div.innerHTML=`
          <img src="${post.userPhoto}" style="width:30px;height:30px;border-radius:50%;vertical-align:middle;margin-right:8px;">
          <strong>
            <a href="#" onclick="viewProfile('${post.userId}')">${post.userName}</a>
          </strong>: ${post.content}
        `;
        postsContainer.appendChild(div);
      });
    });

    // CHAT
    const chatContainer = document.getElementById("chat-container");
    document.getElementById("chat-form").addEventListener("submit", e => {
     
