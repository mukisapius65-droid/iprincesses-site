<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPrincesses Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background:#f0f0f5; }
header { background: #ff6f91; color:white; padding:15px; display:flex; justify-content: space-between; align-items:center; }
header h1 { margin:0; font-size:1.5rem; }
button { padding: 8px 15px; border:none; border-radius:5px; cursor:pointer; }
button:hover { opacity:0.9; }
.container { max-width:900px; margin:20px auto; padding:10px; }
.card { background:white; padding:15px; border-radius:10px; margin:10px 0; box-shadow:0 2px 5px rgba(0,0,0,0.2);}
input, textarea { width:100%; padding:10px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
.chat-box { max-height:200px; overflow-y:auto; border:1px solid #ddd; padding:10px; border-radius:5px; margin-bottom:10px; background:#f9f9f9;}
.post { border-bottom:1px solid #eee; padding:10px 0; }
.comment { padding-left:20px; font-size:0.9rem; color:#555; }
.map-container { width:100%; height:200px; margin:10px 0; border-radius:10px; overflow:hidden;}
.avatar { width:40px; height:40px; border-radius:50%; vertical-align:middle; margin-right:10px; }
.flex { display:flex; align-items:center; }
.like-btn, .share-btn, .comment-btn { margin-right:5px; padding:5px 10px; font-size:0.9rem; }
</style>
</head>
<body>

<header>
  <h1>iPrincesses Dashboard ðŸ‘‘</h1>
  <button id="logout-btn">Logout</button>
</header>

<div class="container" id="dashboard">

  <!-- User greeting -->
  <div class="card flex">
    <img src="https://i.pravatar.cc/40" class="avatar" id="user-avatar" />
    <h2 id="welcome-msg">Hello, User!</h2>
  </div>

  <!-- Create Post -->
  <div class="card">
    <h3>Create Post</h3>
    <textarea id="post-content" placeholder="Share your thoughts..."></textarea>
    <input type="file" id="post-media" accept="image/*,video/*">
    <button id="post-btn">Post</button>
  </div>

  <!-- Posts Feed -->
  <div class="card">
    <h3>Feed</h3>
    <div id="posts-container"></div>
  </div>

  <!-- Chat Section -->
  <div class="card">
    <h3>Chat</h3>
    <select id="room-select">
      <option value="General">General</option>
      <option value="Friends">Friends</option>
      <option value="Support">Support</option>
    </select>
    <div class="chat-box" id="chat-box"></div>
    <input type="text" id="chat-input" placeholder="Type message..." />
    <button id="chat-send-btn">Send</button>
  </div>

  <!-- Location Sharing -->
  <div class="card">
    <h3>Share Your Location</h3>
    <button id="share-location-btn">Share My Location</button>
    <div class="map-container" id="map"></div>
  </div>

  <!-- Payment Options -->
  <div class="card">
    <h3>Payment Options (Uganda)</h3>
    <button id="mtn-btn">Pay with MTN Mobile Money</button>
    <button id="airtel-btn">Pay with Airtel Money</button>
  </div>

  <!-- Call Support -->
  <div class="card">
    <h3>Call</h3>
    <button onclick="window.location.href='tel:+256700000000'">Call iPrincesses Support</button>
  </div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBE7nyRgJU3-VEvnx_MgUJFcN7Qz04yT0g",
  authDomain: "iprincesses-f4f94.firebaseapp.com",
  projectId: "iprincesses-f4f94",
  storageBucket: "iprincesses-f4f94.firebasestorage.app",
  messagingSenderId: "867887611060",
  appId: "1:867887611060:web:f5c15533019c98d4c26be1",
  measurementId: "G-7C9VZKX8MW"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// Logout
document.getElementById("logout-btn").addEventListener("click",()=>auth.signOut());

// Persist login and display user info
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("welcome-msg").textContent=`Hello, ${user.email}! ðŸ‘‘`;
    loadPosts();
    loadChat();
  } else {
    Swal.fire('Logged out','Please log in again','info');
    document.body.innerHTML='<h2 style="text-align:center;margin-top:50px;">You must log in to access dashboard</h2>';
  }
});

// Create Post with Media
document.getElementById('post-btn').addEventListener('click', async ()=>{
  const content = document.getElementById('post-content').value;
  const mediaFile = document.getElementById('post-media').files[0];
  let mediaUrl = '';

  if(mediaFile){
    const storageRef = storage.ref('posts/' + Date.now() + '_' + mediaFile.name);
    await storageRef.put(mediaFile);
    mediaUrl = await storageRef.getDownloadURL();
  }

  db.collection('posts').add({
    content: content,
    media: mediaUrl,
    timestamp: Date.now(),
    likes:0,
    comments:[],
    author: auth.currentUser.email
  });

  document.getElementById('post-content').value='';
  document.getElementById('post-media').value='';
});

// Load posts
function loadPosts(){
  const postsContainer = document.getElementById('posts-container');
  db.collection('posts').orderBy('timestamp','desc').onSnapshot(snapshot=>{
    postsContainer.innerHTML='';
    snapshot.forEach(doc=>{
      const data = doc.data();
      let mediaHtml = '';
      if(data.media){
        if(data.media.endsWith('.mp4')){
          mediaHtml = `<video width="100%" controls><source src="${data.media}"></video>`;
        } else {
          mediaHtml = `<img src="${data.media}" style="width:100%;border-radius:10px;">`;
        }
      }
      let commentsHtml = '';
      data.comments.forEach(c=>commentsHtml+=`<div class="comment"><b>${c.user}:</b> ${c.text}</div>`);
      const postEl = document.createElement('div');
      postEl.className='post';
      postEl.innerHTML = `
        <div class="flex"><img src="https://i.pravatar.cc/40" class="avatar"><b>${data.author}</b></div>
        <p>${data.content}</p>
        ${mediaHtml}
        <small>Likes: ${data.likes} | Comments: ${data.comments.length}</small><br>
        <button class="like-btn" onclick="likePost('${doc.id}', ${data.likes})">Like</button>
        <button class="comment-btn" onclick="addComment('${doc.id}')">Comment</button>
        <div>${commentsHtml}</div>
      `;
      postsContainer.appendChild(postEl);
    });
  });
}

// Like and Comment
function likePost(id,current){ db.collection('posts').doc(id).update({likes: current+1}); }
function addComment(id){
  Swal.fire({title:'Add Comment',input:'text',showCancelButton:true,inputPlaceholder:'Write comment...'})
  .then(result=>{
    if(result.value){
      const user = auth.currentUser.email;
      db.collection('posts').doc(id).update({comments: firebase.firestore.FieldValue.arrayUnion({user:user,text:result.value})});
    }
  });
}

// Chat with Rooms
let currentRoom = 'General';
const chatBox = document.getElementById('chat-box');
const chatInput = document.getElementById('chat-input');
const chatSendBtn = document.getElementById('chat-send-btn');
const roomSelect = document.getElementById('room-select');

roomSelect.addEventListener('change',()=>{ currentRoom = roomSelect.value; loadChat(); });

chatSendBtn.addEventListener('click',()=>{
  const msg = chatInput.value;
  if(msg.trim()==='') return;
  db.collection('chat').add({message:msg,timestamp:Date.now(),user:auth.currentUser.email,room:currentRoom});
  chatInput.value='';
});

function loadChat(){
  db.collection('chat').where('room','==',currentRoom).orderBy('timestamp').onSnapshot(snapshot=>{
    chatBox.innerHTML='';
    snapshot.forEach(doc=>{
      const data = doc.data();
      chatBox.innerHTML += `<p><b>${data.user}:</b> ${data.message}</p>`;
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}

// Location
document.getElementById('share-location-btn').addEventListener('click',()=>{
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos
